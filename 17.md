NIP-17
======

Git Code Collaboration
-----------------

`draft` `optional` `author:DanConwayDev`

This NIP sets out a standard for git-based code collaboration.

### Events

| kind    | name         |
| ------- | ------------ |
| `30017` | Repository   |
| `318`     | Pull Request |
| `19851985`     | Status |
| `317`    | Commit       |

### Repository

A `kind 30017` parameterized replaceable event used as a unique reference and to store associated settings.

#### Tags

| Required | Description | Format |
| -------- | ------------------------------------------ | ---------- |
| X | repository root commit id (forks should instead use earliest unique commit id) | `["d","26689f97810fc656c7134c76e2a37d33b2e40ce7"]` |
| X | name | `["name","name..."]` |
|   | description | `["description","description..."]` |
| X | git server | `["git-server", "https://github.com/nostr-protocol/nips","git://selfhostedgit.com/nips"]` |
|   | other maintainers\* | `["p","pubkey"]` |
| X | relays\* | `["r","wss://relayable.org"]` |

\*use multiple tags to reference multiple entities

`content` SHOULD equal `""`

To identify who's `30017` event should be trusted for a given repository, maintainers can add a `maintainers.yaml` file to their repository root.

```
[maintainers]
npub34543...
npube7e28...
...
[relays]
wss://relayable.org
...
```

### Pull Request

A `kind 318` event for which commit events and responses can be hung on.

#### Tags

| Required | Description | Format |
| -------- | ------------------------------------------ | ---------- |
| X | name | `["name","name..."]` |
| X | branch name - short and formatted for a git branch | `["branch-name","[proposed-branch-name]"]` |
|   | description | `["description","description..."]` |
| X | repository reference | `["r", "r-[repository root commit id]"]` |

`content` MAY be blank or contain the name and description


### Status

A `kind 19851985` event which applies a status to a PR or Issue event. it differs from NIP-32 labels as only one status can apply at a given time.

The authoritative status is the event with largest non-future `created_at` timestamp, unless a status is made explicit in a trusted repository state cache (see section below).

#### Tags

| Required | Description | Format |
| -------- | ------------------------------------------ | ---------- |
| X | name | `["l","[status]"]` |
| X | pr or issue event for which the status relates | `["e",pubkey]` |
| X | repository reference | `["r", "r-[repository root commit id]"]` |

`content` SHOULD equal `""`

### Commit

A `kind 317` event from which a maintaining its commit id.

`content` must be the commit's diff in git patch format. 

#### Tags

| Required | Description | Format |
| -------- | ------------------------------------------ | ---------- |
| X | repository reference | `["r", "r-[repository root commit id]"]` |
| X | commit id as reference | `["r", "r[commit id]"]` |
| X | commit id of parent as reference | `["r", "r[commit id]"]` |
| X | commit id | `["commit","[commit id]"]` |
| X | commit id of parent | `["parent-commit","commit id"]` |
| X | commit pgp signature - this can be ommited or an empty string if commit is not signed | `["commit-sig","-----BEGIN PGP SIGNATURE-----\n\niQIz..."]` |
| X | description SHOULD be taken from the commit message | `["description","fix: sorted the thing"]` |
| X | author (as specified in commit) | `["author", "[name]", "[email]", "[unixtime],[timezone offset in minutes]"]` |
| X | committer (as specified in commit) | `["author", "[name]", "[email]", "[unixtime],[timezone offset in minutes]"]` |

These tags, alongside the `content` provide sufficent information fully recreate the commit the a git repository where the parent commit is present.

### Code Comments

Tag standards for referencing specific lines of code.

TODO

### Replies

Replies SHOULD be `kind 1` events tagging the PR event as `root`.

### Issue

TODO

### Repository Lists

TODO: public and private follow lists.

### Repository state caches

TODO: parameterized replaceable event issued by maintainers that outline a point of time snapshot of PRs and their statuses to prevent users from having to query relays for old PRs.

They could also lock the status of PRs or be used in spam protection or to soft-lock issues.